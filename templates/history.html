{% extends "base.html" %}

{% block title %}å­¦ç¿’å±¥æ­´ - åŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“ å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ {% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">å­¦ç¿’å±¥æ­´</h1>
        <p class="text-gray-600">ã‚ãªãŸã®å­¦ç¿’ã®é€²æ—ã¨æˆæœã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
    </div>

    {% if history.daily_stats %}
    <!-- æ—¥åˆ¥çµ±è¨ˆ -->
    <div class="card p-6 mb-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ“Š æ—¥åˆ¥å­¦ç¿’çµ±è¨ˆ</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {% for stat in history.daily_stats[:7] %}
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="text-sm text-gray-600">{{ stat.date }}</div>
                <div class="text-lg font-semibold text-gray-900">{{ stat.total }}å•</div>
                <div class="text-sm {{ 'text-green-600' if (stat.correct / stat.total * 100) >= 70 else 'text-orange-600' if (stat.correct / stat.total * 100) >= 50 else 'text-red-600' }}">
                    æ­£ç­”ç‡ {{ "%.1f"|format(stat.correct / stat.total * 100) }}%
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- è©³ç´°å±¥æ­´ -->
    <div class="card p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ“ è©³ç´°å±¥æ­´</h2>
        
        {% if history.detailed_history %}
        <div class="space-y-4">
            {% for entry in history.detailed_history %}
            <div class="border border-gray-200 rounded-lg p-4 {{ 'bg-green-50 border-green-200' if entry.is_correct else 'bg-red-50 border-red-200' }}">
                <div class="flex items-start justify-between mb-2">
                    <div class="flex items-center space-x-3">
                        <span class="text-lg">{{ 'âœ…' if entry.is_correct else 'âŒ' }}</span>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            {{ entry.genre or 'æœªåˆ†é¡' }}
                        </span>
                    </div>
                    <span class="text-sm text-gray-500">
                        {{ entry.answered_at[:10] }} {{ entry.answered_at[11:19] }}
                    </span>
                </div>
                
                <div class="mb-2">
                    <p class="text-gray-800 font-medium">{{ entry.question_text[:100] }}{{ '...' if entry.question_text|length > 100 else '' }}</p>
                </div>
                
                <div class="text-sm text-gray-600 space-y-1">
                    <div>
                        <span class="font-medium">ã‚ãªãŸã®è§£ç­”:</span> 
                        <span class="{{ 'text-green-600' if entry.is_correct else 'text-red-600' }}">{{ entry.user_answer }}</span>
                    </div>
                    {% if not entry.is_correct %}
                    <div>
                        <span class="font-medium">æ­£è§£:</span> 
                        <span class="text-green-600">{{ entry.correct_answer }}</span>
                    </div>
                    {% endif %}
                    {% if entry.explanation %}
                    <div class="mt-2 p-3 bg-blue-50 rounded border-l-4 border-blue-200">
                        <span class="font-medium text-blue-800">è§£èª¬:</span>
                        <p class="text-blue-700 mt-1">{{ entry.explanation }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if history.detailed_history|length == 50 %}
        <div class="mt-6 text-center">
            <p class="text-gray-600 text-sm">æœ€æ–°50ä»¶ã®å±¥æ­´ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
        </div>
        {% endif %}
        
        {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">ğŸ“Š</div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">å­¦ç¿’å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</h3>
            <p class="text-gray-600 mb-6">å•é¡Œã‚’è§£ã„ã¦å­¦ç¿’å±¥æ­´ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼</p>
            <div class="space-x-4">
                <a href="{{ url_for('random') }}" class="btn-primary">
                    ãƒ©ãƒ³ãƒ€ãƒ å•é¡Œã«æŒ‘æˆ¦
                </a>
                <a href="{{ url_for('genre_practice') }}" class="btn-secondary">
                    ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥æ¼”ç¿’
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // å±¥æ­´é …ç›®ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    const historyItems = document.querySelectorAll('.space-y-4 > div');
    historyItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateX(-20px)';
        setTimeout(() => {
            item.style.transition = 'all 0.3s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateX(0)';
        }, index * 50);
    });
});
</script>
{% endblock %}
