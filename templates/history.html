{% extends "base.html" %}

{% block title %}学習履歴 - 基本情報技術者試験 学習プラットフォーム{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">学習履歴</h1>
        <p class="text-gray-600">あなたの学習の進捗と成果を確認できます。</p>
    </div>

    {% if history.daily_stats %}
    <!-- 日別統計 -->
    <div class="card p-6 mb-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">📊 日別学習統計</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {% for stat in history.daily_stats[:7] %}
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="text-sm text-gray-600">{{ stat.date }}</div>
                <div class="text-lg font-semibold text-gray-900">{{ stat.total }}問</div>
                <div class="text-sm {{ 'text-green-600' if (stat.correct / stat.total * 100) >= 70 else 'text-orange-600' if (stat.correct / stat.total * 100) >= 50 else 'text-red-600' }}">
                    正答率 {{ "%.1f"|format(stat.correct / stat.total * 100) }}%
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- 詳細履歴 -->
    <div class="card p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">📝 詳細履歴</h2>
        
        {% if history.detailed_history %}
        <div class="space-y-4">
            {% for entry in history.detailed_history %}
            <div class="border border-gray-200 rounded-lg p-4 {{ 'bg-green-50 border-green-200' if entry.is_correct else 'bg-red-50 border-red-200' }}">
                <div class="flex items-start justify-between mb-2">
                    <div class="flex items-center space-x-3">
                        <span class="text-lg">{{ '✅' if entry.is_correct else '❌' }}</span>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            {{ entry.genre or '未分類' }}
                        </span>
                    </div>
                    <span class="text-sm text-gray-500">
                        {{ entry.answered_at[:10] }} {{ entry.answered_at[11:19] }}
                    </span>
                </div>
                
                <div class="mb-2">
                    <p class="text-gray-800 font-medium">{{ entry.question_text[:100] }}{{ '...' if entry.question_text|length > 100 else '' }}</p>
                </div>
                
                <div class="text-sm text-gray-600 space-y-1">
                    <div>
                        <span class="font-medium">あなたの解答:</span> 
                        <span class="{{ 'text-green-600' if entry.is_correct else 'text-red-600' }}">{{ entry.user_answer }}</span>
                    </div>
                    {% if not entry.is_correct %}
                    <div>
                        <span class="font-medium">正解:</span> 
                        <span class="text-green-600">{{ entry.correct_answer }}</span>
                    </div>
                    {% endif %}
                    {% if entry.explanation %}
                    <div class="mt-2 p-3 bg-blue-50 rounded border-l-4 border-blue-200">
                        <span class="font-medium text-blue-800">解説:</span>
                        <p class="text-blue-700 mt-1">{{ entry.explanation }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if history.detailed_history|length == 50 %}
        <div class="mt-6 text-center">
            <p class="text-gray-600 text-sm">最新50件の履歴を表示しています。</p>
        </div>
        {% endif %}
        
        {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">📊</div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">学習履歴がありません</h3>
            <p class="text-gray-600 mb-6">問題を解いて学習履歴を作成しましょう！</p>
            <div class="space-x-4">
                <a href="{{ url_for('random') }}" class="btn-primary">
                    ランダム問題に挑戦
                </a>
                <a href="{{ url_for('genre_practice') }}" class="btn-secondary">
                    ジャンル別演習
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 履歴項目のアニメーション
    const historyItems = document.querySelectorAll('.space-y-4 > div');
    historyItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateX(-20px)';
        setTimeout(() => {
            item.style.transition = 'all 0.3s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateX(0)';
        }, index * 50);
    });
});
</script>
{% endblock %}
