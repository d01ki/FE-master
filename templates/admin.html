{% extends "base.html" %}

{% block title %}ç®¡ç†ç”»é¢ - åŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“ å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ {% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">ğŸ”§ ç®¡ç†ç”»é¢</h1>
        <p class="text-gray-600">ã‚·ã‚¹ãƒ†ãƒ ã®ç®¡ç†ã¨å•é¡Œã®è¿½åŠ ã‚’è¡Œãˆã¾ã™ã€‚</p>
    </div>

    <!-- çµ±è¨ˆæƒ…å ± -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="text-3xl">ğŸ“š</div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">ç·å•é¡Œæ•°</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ data.question_count }}</p>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="text-3xl">ğŸ‘¥</div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ data.user_count }}</p>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="text-3xl">ğŸ·ï¸</div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">ã‚¸ãƒ£ãƒ³ãƒ«æ•°</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ data.genres|length }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å•é¡Œè¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">â• æ–°ã—ã„å•é¡Œã‚’è¿½åŠ </h2>
        
        <form id="addQuestionForm" class="space-y-6">
            <!-- å•é¡Œæ–‡ -->
            <div>
                <label for="questionText" class="block text-sm font-medium text-gray-700 mb-2">
                    å•é¡Œæ–‡ <span class="text-red-500">*</span>
                </label>
                <textarea id="questionText" name="question_text" rows="4" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required></textarea>
            </div>

            <!-- é¸æŠè‚¢ -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    é¸æŠè‚¢ <span class="text-red-500">*</span>
                </label>
                <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                        <span class="font-medium text-gray-700 w-6">A.</span>
                        <input type="text" id="choiceA" name="choice_a" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="é¸æŠè‚¢A" required>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-medium text-gray-700 w-6">B.</span>
                        <input type="text" id="choiceB" name="choice_b" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="é¸æŠè‚¢B" required>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-medium text-gray-700 w-6">C.</span>
                        <input type="text" id="choiceC" name="choice_c" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="é¸æŠè‚¢C" required>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-medium text-gray-700 w-6">D.</span>
                        <input type="text" id="choiceD" name="choice_d" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="é¸æŠè‚¢D" required>
                    </div>
                </div>
            </div>

            <!-- æ­£è§£ -->
            <div>
                <label for="correctAnswer" class="block text-sm font-medium text-gray-700 mb-2">
                    æ­£è§£ <span class="text-red-500">*</span>
                </label>
                <select id="correctAnswer" name="correct_answer" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    <option value="">æ­£è§£ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                </select>
            </div>

            <!-- è§£èª¬ -->
            <div>
                <label for="explanation" class="block text-sm font-medium text-gray-700 mb-2">è§£èª¬</label>
                <textarea id="explanation" name="explanation" rows="3"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          placeholder="è§£èª¬ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰"></textarea>
            </div>

            <!-- ã‚¸ãƒ£ãƒ³ãƒ« -->
            <div>
                <label for="genre" class="block text-sm font-medium text-gray-700 mb-2">ã‚¸ãƒ£ãƒ³ãƒ«</label>
                <input type="text" id="genre" name="genre" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="ä¾‹: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒ»ãƒ‡ãƒ¼ã‚¿æ§‹é€ " list="genreList">
                <datalist id="genreList">
                    {% for genre in data.genres %}
                    <option value="{{ genre }}">
                    {% endfor %}
                </datalist>
            </div>

            <!-- é›£æ˜“åº¦ -->
            <div>
                <label for="difficulty" class="block text-sm font-medium text-gray-700 mb-2">é›£æ˜“åº¦</label>
                <select id="difficulty" name="difficulty" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="åŸºç¤">åŸºç¤</option>
                    <option value="æ¨™æº–">æ¨™æº–</option>
                    <option value="å¿œç”¨">å¿œç”¨</option>
                </select>
            </div>

            <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
            <div class="flex justify-end space-x-4">
                <button type="button" id="resetForm" class="btn-secondary">
                    ãƒªã‚»ãƒƒãƒˆ
                </button>
                <button type="submit" id="submitQuestion" class="btn-primary">
                    å•é¡Œã‚’è¿½åŠ 
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('addQuestionForm');
    const submitBtn = document.getElementById('submitQuestion');
    const resetBtn = document.getElementById('resetForm');
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        const questionData = {
            question_text: formData.get('question_text'),
            choices: [
                formData.get('choice_a'),
                formData.get('choice_b'),
                formData.get('choice_c'),
                formData.get('choice_d')
            ],
            correct_answer: formData.get('correct_answer'),
            explanation: formData.get('explanation'),
            genre: formData.get('genre'),
            difficulty: formData.get('difficulty')
        };
        
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if (!questionData.question_text.trim()) {
            alert('å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        if (questionData.choices.some(choice => !choice.trim())) {
            alert('ã™ã¹ã¦ã®é¸æŠè‚¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        if (!questionData.correct_answer) {
            alert('æ­£è§£ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
        submitBtn.disabled = true;
        submitBtn.textContent = 'è¿½åŠ ä¸­...';
        
        // å•é¡Œã‚’è¿½åŠ 
        fetch('/admin/add_question', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(questionData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('å•é¡ŒãŒæ­£å¸¸ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼');
                form.reset();
                // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦çµ±è¨ˆã‚’æ›´æ–°
                window.location.reload();
            } else {
                alert('ã‚¨ãƒ©ãƒ¼: ' + (data.error || 'å•é¡Œã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
        })
        .finally(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = 'å•é¡Œã‚’è¿½åŠ ';
        });
    });
    
    // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
    resetBtn.addEventListener('click', function() {
        if (confirm('å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
            form.reset();
        }
    });
    
    // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    const formElements = form.querySelectorAll('div');
    formElements.forEach((element, index) => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(20px)';
        setTimeout(() => {
            element.style.transition = 'all 0.3s ease';
            element.style.opacity = '1';
            element.style.transform = 'translateY(0)';
        }, index * 50);
    });
});
</script>
{% endblock %}
