{% extends "base.html" %}

{% block title %}ダッシュボード - {{ super() }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="relative mb-12 overflow-hidden">
    <div class="gradient-bg rounded-2xl p-8 text-white relative">
        <div class="relative z-10">
            <div class="max-w-4xl">
                <h1 class="text-4xl font-bold mb-4 animate-float">
                    <i class="fas fa-rocket mr-3"></i>基本情報技術者試験 学習ダッシュボード
                </h1>
                <p class="text-xl opacity-90 mb-6">
                    あなたの学習進捗を確認し、効率的に試験対策を進めましょう！
                </p>
                <div class="flex flex-wrap gap-4">
                    <a href="{{ url_for('random_question') }}" 
                       class="glass-effect px-6 py-3 rounded-lg hover:bg-white hover:bg-opacity-30 transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-play mr-2"></i>今すぐ練習開始
                    </a>
                    <a href="{{ url_for('mock_exam') }}" 
                       class="glass-effect px-6 py-3 rounded-lg hover:bg-white hover:bg-opacity-30 transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-clipboard-list mr-2"></i>模擬試験に挑戦
                    </a>
                </div>
            </div>
        </div>
        <!-- Floating elements -->
        <div class="absolute top-4 right-4 opacity-20">
            <i class="fas fa-code text-6xl animate-pulse-slow"></i>
        </div>
        <div class="absolute bottom-4 right-16 opacity-20">
            <i class="fas fa-laptop-code text-4xl animate-float"></i>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
    <div class="card group">
        <div class="card-body text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-question-circle text-white text-2xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-1">{{ stats.total_questions }}</h3>
            <p class="text-gray-600 text-sm">総問題数</p>
        </div>
    </div>

    <div class="card group">
        <div class="card-body text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-pen text-white text-2xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-1">{{ stats.total_answers }}</h3>
            <p class="text-gray-600 text-sm">解答済み問題</p>
        </div>
    </div>

    <div class="card group">
        <div class="card-body text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-check-circle text-white text-2xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-1">{{ stats.correct_answers }}</h3>
            <p class="text-gray-600 text-sm">正解数</p>
        </div>
    </div>

    <div class="card group">
        <div class="card-body text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-chart-line text-white text-2xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-1">{{ stats.accuracy_rate }}%</h3>
            <p class="text-gray-600 text-sm">正答率</p>
        </div>
    </div>
</div>

<!-- Action Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
    <a href="{{ url_for('random_question') }}" class="group block">
        <div class="card h-full">
            <div class="card-body text-center p-8">
                <div class="w-20 h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:rotate-12 transition-transform duration-300">
                    <i class="fas fa-random text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-primary transition-colors duration-300">
                    ランダム練習
                </h3>
                <p class="text-gray-600 mb-4">
                    ランダムに選ばれた問題で基礎力を鍛えましょう。毎回異なる問題で飽きずに学習できます。
                </p>
                <span class="inline-flex items-center text-primary font-medium group-hover:underline">
                    今すぐ開始 <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-300"></i>
                </span>
            </div>
        </div>
    </a>

    <a href="{{ url_for('mock_exam') }}" class="group block">
        <div class="card h-full">
            <div class="card-body text-center p-8">
                <div class="w-20 h-20 bg-gradient-to-br from-red-400 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:rotate-12 transition-transform duration-300">
                    <i class="fas fa-clipboard-list text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-primary transition-colors duration-300">
                    模擬試験
                </h3>
                <p class="text-gray-600 mb-4">
                    本番形式の模擬試験で実力をテスト。年度別の過去問で実際の試験に向けた準備ができます。
                </p>
                <span class="inline-flex items-center text-primary font-medium group-hover:underline">
                    試験を選択 <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-300"></i>
                </span>
            </div>
        </div>
    </a>

    <a href="{{ url_for('history') }}" class="group block">
        <div class="card h-full">
            <div class="card-body text-center p-8">
                <div class="w-20 h-20 bg-gradient-to-br from-indigo-400 to-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:rotate-12 transition-transform duration-300">
                    <i class="fas fa-history text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-primary transition-colors duration-300">
                    学習履歴
                </h3>
                <p class="text-gray-600 mb-4">
                    これまでの学習記録を確認して、弱点を把握し効率的な学習計画を立てましょう。
                </p>
                <span class="inline-flex items-center text-primary font-medium group-hover:underline">
                    履歴を確認 <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-300"></i>
                </span>
            </div>
        </div>
    </a>
</div>

<!-- Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Genre Statistics -->
    {% if stats.genre_stats %}
    <div class="card">
        <div class="card-header">
            <h2 class="text-xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-chart-pie text-primary mr-3"></i>
                ジャンル別正答率
            </h2>
        </div>
        <div class="card-body">
            <div class="space-y-6">
                {% for genre_stat in stats.genre_stats %}
                {% set accuracy = (genre_stat.correct / genre_stat.total * 100) | round(1) if genre_stat.total > 0 else 0 %}
                <div class="group">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium text-gray-900">{{ genre_stat.genre }}</span>
                        <div class="text-right">
                            <span class="text-sm font-bold {% if accuracy >= 80 %}text-green-600{% elif accuracy >= 60 %}text-yellow-600{% else %}text-red-600{% endif %}">
                                {{ accuracy }}%
                            </span>
                            <span class="text-xs text-gray-500 block">
                                {{ genre_stat.correct }}/{{ genre_stat.total }}問
                            </span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                        <div class="h-3 rounded-full transition-all duration-1000 ease-out group-hover:scale-105
                                    {% if accuracy >= 80 %}bg-gradient-to-r from-green-400 to-green-600
                                    {% elif accuracy >= 60 %}bg-gradient-to-r from-yellow-400 to-orange-500
                                    {% else %}bg-gradient-to-r from-red-400 to-red-600{% endif %}" 
                             style="width: {{ accuracy }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Recent History -->
    {% if stats.recent_history %}
    <div class="card">
        <div class="card-header">
            <h2 class="text-xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-clock text-primary mr-3"></i>
                最近の学習履歴
            </h2>
        </div>
        <div class="card-body">
            <div class="space-y-4 max-h-96 overflow-y-auto">
                {% for history in stats.recent_history[:10] %}
                <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
                    <div class="flex-shrink-0 mt-1">
                        {% if history.is_correct %}
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-green-600 text-sm"></i>
                            </div>
                        {% else %}
                            <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-times text-red-600 text-sm"></i>
                            </div>
                        {% endif %}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm text-gray-900 line-clamp-2 mb-1">
                            {{ history.question_text[:80] }}{% if history.question_text|length > 80 %}...{% endif %}
                        </p>
                        <p class="text-xs text-gray-500">
                            <i class="fas fa-calendar-alt mr-1"></i>
                            {{ history.answered_at }}
                        </p>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="mt-6 text-center">
                <a href="{{ url_for('history') }}" class="btn btn-secondary">
                    <i class="fas fa-list mr-2"></i>すべての履歴を表示
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- No Data State -->
{% if stats.total_questions == 0 %}
<div class="text-center py-16">
    <div class="max-w-md mx-auto">
        <div class="w-32 h-32 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-8">
            <i class="fas fa-box-open text-6xl text-gray-400"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-4">問題が登録されていません</h3>
        <p class="text-gray-600 mb-8">
            学習を開始するには、まず問題データをアップロードする必要があります。<br>
            管理画面からPDFやJSONファイルをアップロードしてください。
        </p>
        <div class="space-y-4">
            <a href="{{ url_for('admin_login') }}" class="btn btn-primary">
                <i class="fas fa-upload mr-2"></i>管理画面で問題を追加
            </a>
            <div class="text-sm text-gray-500">
                <p><i class="fas fa-info-circle mr-1"></i>推奨ファイル形式</p>
                <p>年度別JSON: 2025r07_kamoku_a_spring.json</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Quick Stats Footer -->
{% if stats.total_questions > 0 %}
<div class="mt-16 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-8">
    <div class="text-center">
        <h3 class="text-2xl font-bold text-gray-900 mb-4">
            <i class="fas fa-trophy text-yellow-500 mr-2"></i>学習の成果
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center">
                <div class="text-3xl font-bold text-blue-600 mb-2">{{ stats.total_answers }}</div>
                <p class="text-gray-600">取り組んだ問題数</p>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-green-600 mb-2">{{ stats.accuracy_rate }}%</div>
                <p class="text-gray-600">現在の正答率</p>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-purple-600 mb-2">{{ stats.genre_stats|length }}</div>
                <p class="text-gray-600">学習ジャンル数</p>
            </div>
        </div>
        <div class="mt-6">
            <p class="text-gray-700 italic">
                「継続は力なり」- 毎日少しずつでも学習を続けることで、確実に実力がつきます！
            </p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
// Progress animation on load
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress bars
    const progressBars = document.querySelectorAll('[style*="width:"]');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });
    
    // Counter animation for stats
    const counters = document.querySelectorAll('.text-2xl.font-bold');
    counters.forEach(counter => {
        const target = parseInt(counter.textContent);
        if (!isNaN(target)) {
            let current = 0;
            const increment = target / 30;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    counter.textContent = target + (counter.textContent.includes('%') ? '%' : '');
                    clearInterval(timer);
                } else {
                    counter.textContent = Math.floor(current) + (counter.textContent.includes('%') ? '%' : '');
                }
            }, 50);
        }
    });
});
</script>
{% endblock %}
